<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="IndustryHub Pro - Endüstriyel Ürün Kataloğu">
    <title>IndustryHub Pro - Ürün Kataloğu</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Slider CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider@14.6.3/distribute/nouislider.min.css">
    
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    
    <!-- Custom CSS -->
    <style>
        /* Root Variables */
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1e40af;
            --primary-light: #3b82f6;
            --secondary-color: #64748b;
            --success-color: #22c55e;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --background-color: #f8fafc;
            --text-color: #1e293b;
            --text-light: #64748b;
            --border-color: #e2e8f0;
            --white: #ffffff;
            
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-full: 9999px;
            
            --transition-base: all 0.3s ease;
            --transition-smooth: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            
            --container-width: 1400px;
            --header-height: 4rem;
            --filter-width: 300px;
        }

        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.5;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        /* Scrollbar Styles */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--background-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--secondary-color);
            border-radius: var(--radius-full);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
            transition: var(--transition-smooth);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spinner 1s linear infinite;
        }

        @keyframes spinner {
            to { transform: rotate(360deg); }
        }

        /* Header Styles */
        .header {
            position: sticky;
            top: 0;
            background: var(--white);
            box-shadow: var(--shadow-sm);
            z-index: 100;
            height: var(--header-height);
            display: flex;
            align-items: center;
        }

        .header-container {
            width: 100%;
            max-width: var(--container-width);
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            align-items: center;
            gap: 2rem;
        }
        /* User Dropdown Styles */
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--white);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            min-width: 200px;
            padding: 0.5rem;
            display: none;
            z-index: 1000;
        }
        
        .user-dropdown.active {
            display: block;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: var(--text-color);
            text-decoration: none;
            border-radius: var(--radius-sm);
            transition: var(--transition-base);
        }
        
        .dropdown-item:hover {
            background: var(--background-color);
        }
        
        .dropdown-item.danger {
            color: var(--danger-color);
        }
        
        .dropdown-divider {
            margin: 0.5rem 0;
            border: none;
            border-top: 1px solid var(--border-color);
        }
        /* Logo */
        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
            transition: var(--transition-base);
        }

        .logo:hover {
            color: var(--primary-dark);
        }

        .logo i {
            font-size: 1.5rem;
        }

        /* Search Container */
        .search-container {
            flex: 1;
            max-width: 600px;
            position: relative;
        }

        .search-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 2.5rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            font-size: 0.95rem;
            transition: var(--transition-base);
            background: var(--white);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            color: var(--text-light);
            pointer-events: none;
        }

        /* Navigation */
        .nav-menu {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .nav-link {
            color: var(--text-color);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            transition: var(--transition-base);
            font-weight: 500;
        }

        .nav-link:hover {
            background: var(--background-color);
        }

        .nav-link.active {
            background: var(--primary-color);
            color: var(--white);
        }

        /* Cart Icon */
        .cart-link {
            position: relative;
            padding: 0.5rem;
            color: var(--text-color);
            text-decoration: none;
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--primary-color);
            color: var(--white);
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-full);
            min-width: 20px;
            text-align: center;
        }

        /* Hamburger Menu */
        .hamburger-menu {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            margin-left: auto;
        }

        .hamburger-line {
            display: block;
            width: 24px;
            height: 2px;
            background-color: var(--text-color);
            margin: 5px 0;
            transition: var(--transition-base);
        }

        /* Main Content Layout */
        .main-content {
            display: flex;
            gap: 2rem;
            max-width: var(--container-width);
            margin: 2rem auto;
            padding: 0 1rem;
        }

        /* Filter Sidebar */
        .filter-sidebar {
            width: var(--filter-width);
            flex-shrink: 0;
            background: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            height: fit-content;
            position: sticky;
            top: calc(var(--header-height) + 2rem);
        }

        .filter-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .clear-filters {
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 0.875rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius-md);
            transition: var(--transition-base);
        }

        .clear-filters:hover {
            background: var(--background-color);
        }

        .filter-body {
            padding: 1.5rem;
        }

        .filter-section {
            margin-bottom: 1.5rem;
        }

        .filter-section:last-child {
            margin-bottom: 0;
        }

        .filter-section-header {
            margin-bottom: 1rem;
            font-weight: 600;
        }

        /* Category Filter */
        .category-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .category-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-base);
        }

        .category-item:hover {
            background: var(--background-color);
        }

        .category-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            position: relative;
            transition: var(--transition-base);
        }

        .category-item input:checked + .category-checkbox {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .category-item input:checked + .category-checkbox::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 6px;
            width: 4px;
            height: 8px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        /* Price Range Slider */
        .price-range-slider {
            margin: 2rem 0;
        }

        .price-inputs {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }

        .price-input {
            width: 45%;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
        }

        /* Active Filters */
        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .filter-tag {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--background-color);
            border-radius: var(--radius-full);
            font-size: 0.875rem;
        }

        .filter-tag-remove {
            cursor: pointer;
            color: var(--text-light);
            transition: var(--transition-base);
        }
                /* Product Grid */
        .products-container {
            flex: 1;
        }

        .products-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .products-count {
            font-size: 1.125rem;
            font-weight: 500;
        }

        .sort-select {
            padding: 0.5rem 2rem 0.5rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--white);
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E</polyline%3E</svg>");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
        }

        /* Product Card */
        .product-card {
            background: var(--white);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: var(--transition-smooth);
            position: relative;
            display: flex;
            flex-direction: column;
            height: 100%;
            transform: translateY(0);
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .product-image-container {
            position: relative;
            padding-top: 75%;
            overflow: hidden;
        }

        .product-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition-smooth);
        }

        .product-card:hover .product-image {
            transform: scale(1.05);
        }

        .product-badges {
            position: absolute;
            top: 1rem;
            left: 1rem;
            display: flex;
            gap: 0.5rem;
            z-index: 1;
        }

        .product-badge {
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .badge-3d {
            background: var(--primary-color);
            color: var(--white);
        }

        .badge-new {
            background: var(--success-color);
            color: var(--white);
        }

        .badge-sale {
            background: var(--danger-color);
            color: var(--white);
        }

        .product-content {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            flex: 1;
        }

        .product-category {
            color: var(--text-light);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .product-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-color);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            transition: var(--transition-base);
        }

        .product-card:hover .product-title {
            color: var(--primary-color);
        }

        .product-manufacturer {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-light);
            font-size: 0.875rem;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stars {
            display: flex;
            gap: 0.25rem;
            color: var(--warning-color);
        }

        .rating-count {
            color: var(--text-light);
            font-size: 0.875rem;
        }

        .product-footer {
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .product-price {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .product-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition-base);
        }

        .btn-primary {
            background: var(--primary-color);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--background-color);
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }

            .filter-sidebar {
                width: 100%;
                position: static;
            }
        }

        @media (max-width: 768px) {
            .header-container {
                padding: 0.5rem 1rem;
            }

            .hamburger-menu {
                display: block;
            }

            .nav-menu {
                display: none;
                position: absolute;
                top: var(--header-height);
                left: 0;
                right: 0;
                background: var(--white);
                padding: 1rem;
                flex-direction: column;
                box-shadow: var(--shadow-md);
            }

            .nav-menu.active {
                display: flex;
            }

            .search-container {
                order: 3;
                width: 100%;
                margin-top: 1rem;
            }

            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            .product-actions {
                flex-direction: column;
                width: 100%;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .filter-sidebar {
                margin-bottom: 2rem;
            }

            .products-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
        }

        @media (max-width: 480px) {
            .product-grid {
                grid-template-columns: 1fr;
            }

            .filter-tag {
                font-size: 0.75rem;
                padding: 0.25rem 0.75rem;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                transform: translateY(20px);
                opacity: 0;
            }
            to { 
                transform: translateY(0);
                opacity: 1;
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        .slide-up {
            animation: slideUp 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <a href="/" class="logo">
                <i class="fas fa-industry"></i>
                IndustryHub Pro
            </a>

            <div class="search-container">
                <div class="search-wrapper">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="searchInput" placeholder="Ürün veya kategori ara...">
                </div>
            </div>

            <nav class="nav-menu">
                <a href="/products" class="nav-link active">Ürünler</a>
                <a href="/models" class="nav-link">3B Modeller</a>
                <a href="/technical" class="nav-link">Teknik Çizimler</a>
                <a href="/cart" class="cart-link">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count" id="cartCount">0</span>
                </a>
                <div class="user-menu">
                    <button class="user-button" id="userMenuBtn">
                        <i class="fas fa-user"></i>
                        <span id="userName">Hesap</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="user-dropdown" id="userDropdown">
                        <a href="/profile" class="dropdown-item">
                            <i class="fas fa-user-circle"></i>
                            Profilim
                        </a>
                        <a href="/orders" class="dropdown-item">
                            <i class="fas fa-box"></i>
                            Siparişlerim
                        </a>
                        <a href="/settings" class="dropdown-item">
                            <i class="fas fa-cog"></i>
                            Ayarlar
                        </a>
                        <hr class="dropdown-divider">
                        <button class="dropdown-item danger" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            Çıkış Yap
                        </button>
                    </div>
                </div>
            </nav>

            <button class="hamburger-menu" id="mobileMenuBtn" aria-label="Menüyü aç/kapat">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Filter Sidebar -->
        <aside class="filter-sidebar">
            <div class="filter-header">
                <h2 class="filter-title">Filtreler</h2>
                <button class="clear-filters" id="clearFiltersBtn">
                    <i class="fas fa-times"></i>
                    Temizle
                </button>
            </div>

            <div class="filter-body">
                <!-- Active Filters -->
                <div class="active-filters" id="activeFilters"></div>

                <!-- Category Filter -->
                <div class="filter-section">
                    <h3 class="filter-section-header">Kategoriler</h3>
                    <div class="category-list" id="categoryList">
                        <!-- Categories will be loaded dynamically -->
                    </div>
                </div>

                <!-- Price Range Filter -->
                <div class="filter-section">
                    <h3 class="filter-section-header">Fiyat Aralığı</h3>
                    <div class="price-range-slider" id="priceRangeSlider"></div>
                    <div class="price-inputs">
                        <input type="number" class="price-input" id="minPriceInput" placeholder="Min">
                        <input type="number" class="price-input" id="maxPriceInput" placeholder="Max">
                    </div>
                </div>

                <!-- Rating Filter -->
                <div class="filter-section">
                    <h3 class="filter-section-header">Değerlendirme</h3>
                    <div class="rating-filter" id="ratingFilter">
                        <!-- Rating options will be added here -->
                    </div>
                </div>
            </div>
        </aside>

        <!-- Products Container -->
        <section class="products-container">
            <div class="products-header">
                <div class="products-count" id="productsCount">
                    <!-- Product count will be updated dynamically -->
                </div>
                <select class="sort-select" id="sortSelect">
                    <option value="newest">En Yeniler</option>
                    <option value="priceAsc">Fiyat (Düşük-Yüksek)</option>
                    <option value="priceDesc">Fiyat (Yüksek-Düşük)</option>
                    <option value="rating">En Çok Değerlendirilenler</option>
                    <option value="popular">En Popüler</option>
                </select>
            </div>

            <div class="product-grid" id="productGrid">
                <!-- Products will be loaded dynamically -->
            </div>

            <!-- Loading More Indicator -->
            <div class="loading-more" id="loadingMore" style="display: none;">
                <div class="loading-spinner"></div>
                <span>Daha fazla ürün yükleniyor...</span>
            </div>
        </section>
    </main>

    <!-- Required Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/nouislider@14.6.3/distribute/nouislider.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        // API ve Sabitler
        const API_URL = 'https://eticaret-glif.onrender.com/api';
        const TOKEN_KEY = 'token';
        const USER_KEY = 'user';
        const FILTERS_KEY = 'product_filters';
    
        // State Yönetimi
        const state = {
            products: [],
            filteredProducts: [],
            filters: {
                categories: [],
                priceRange: { min: null, max: null },
                rating: null,
                sort: 'newest',
                search: ''
            },
            pagination: {
                page: 1,
                limit: 12,
                hasMore: true
            },
            loading: false
        };
    
        // Cache Mekanizması
        const cache = {
            products: new Map(),
            categories: null,
            clearCache() {
                this.products.clear();
                this.categories = null;
            }
        };
    
        // Auth Yönetimi
        const auth = {
            token: localStorage.getItem(TOKEN_KEY),
            user: JSON.parse(localStorage.getItem(USER_KEY)),
    
            isAuthenticated() {
                return !!this.token;
            },
    
            setAuth(token, user) {
                this.token = token;
                this.user = user;
                localStorage.setItem(TOKEN_KEY, token);
                localStorage.setItem(USER_KEY, JSON.stringify(user));
                this.updateUI();
            },
    
            clearAuth() {
                this.token = null;
                this.user = null;
                localStorage.removeItem(TOKEN_KEY);
                localStorage.removeItem(USER_KEY);
                cache.clearCache();
                this.updateUI();
            },
    
            updateUI() {
                const userNameEl = document.getElementById('userName');
                if (this.isAuthenticated()) {
                    userNameEl.textContent = this.user.name || 'Kullanıcı';
                } else {
                    userNameEl.textContent = 'Giriş Yap';
                }
            }
        };
    
        // API İstekleri
        async function fetchAPI(endpoint, options = {}) {
            try {
                const defaultHeaders = {
                    'Content-Type': 'application/json'
                };
    
                if (auth.token) {
                    defaultHeaders['Authorization'] = `Bearer ${auth.token}`;
                }
    
                const response = await fetch(`${API_URL}${endpoint}`, {
                    ...options,
                    headers: {
                        ...defaultHeaders,
                        ...options.headers
                    }
                });
    
                if (response.status === 401) {
                    auth.clearAuth();
                    window.location.href = '/login.html';
                    return null;
                }
    
                const data = await response.json();
    
                if (!response.ok) {
                    throw new Error(data.message || 'Bir hata oluştu');
                }
    
                return data;
            } catch (error) {
                showNotification(error.message, 'error');
                throw error;
            }
        }
    
        // Ürün Yönetimi
        const productManager = {
            async loadProducts(refresh = false) {
                if (state.loading) return;
    
                try {
                    state.loading = true;
                    showLoading(true);
    
                    if (refresh) {
                        state.pagination.page = 1;
                        state.pagination.hasMore = true;
                        document.getElementById('productGrid').innerHTML = '';
                    }
    
                    const queryParams = new URLSearchParams({
                        page: state.pagination.page,
                        limit: state.pagination.limit,
                        ...state.filters
                    });
    
                    const data = await fetchAPI(`/products?${queryParams}`);
                    
                    if (data.success) {
                        const products = refresh ? data.products : [...state.products, ...data.products];
                        state.products = products;
                        state.filteredProducts = this.applyFilters(products);
                        state.pagination.hasMore = data.hasMore;
                        state.pagination.page++;
    
                        this.renderProducts();
                        this.updateProductCount();
                        this.saveFiltersToStorage();
                    }
                } catch (error) {
                    console.error('Ürünler yüklenirken hata:', error);
                } finally {
                    state.loading = false;
                    showLoading(false);
                }
            },
    
            applyFilters(products) {
                return products.filter(product => {
                    // Kategori filtresi
                    if (state.filters.categories.length > 0 && 
                        !state.filters.categories.includes(product.category)) {
                        return false;
                    }
            
                    // Fiyat aralığı filtresi
                    if (state.filters.priceRange.min !== null && 
                        product.price < state.filters.priceRange.min) {
                        return false;
                    }
                    if (state.filters.priceRange.max !== null && 
                        product.price > state.filters.priceRange.max) {
                        return false;
                    }
            
                    // Rating filtresi
                    if (state.filters.rating && product.rating < state.filters.rating) {
                        return false;
                    }
            
                    // Arama filtresi - BU KISMI DEĞİŞTİRİN
                    if (state.filters.search) {
                        const searchTerm = state.filters.search.toLowerCase();
                        return product.title.toLowerCase().includes(searchTerm) ||
                               product.description.toLowerCase().includes(searchTerm) ||
                               product.category.toLowerCase().includes(searchTerm);
                    }
            
                    return true;
                }).sort((a, b) => {
                    switch (state.filters.sort) {
                        case 'priceAsc':
                            return a.price - b.price;
                        case 'priceDesc':
                            return b.price - a.price;
                        case 'rating':
                            return b.rating - a.rating;
                        case 'popular':
                            return b.views - a.views;
                        default: // newest
                            return new Date(b.createdAt) - new Date(a.createdAt);
                    }
                });
            },

        renderProducts() {
            const grid = document.getElementById('productGrid');
            const fragment = document.createDocumentFragment();

            state.filteredProducts.forEach((product, index) => {
                const card = this.createProductCard(product);
                card.style.animationDelay = `${index * 50}ms`;
                fragment.appendChild(card);
            });

            if (state.pagination.page === 1) {
                grid.innerHTML = '';
            }
            grid.appendChild(fragment);
        },

        createProductCard(product) {
            const card = document.createElement('article');
            card.className = 'product-card slide-up';
            card.innerHTML = `
                <div class="product-image-container">
                    <img src="${API_URL}${product.image}" alt="${product.title}" loading="lazy" class="product-image">
                    <div class="product-badges">
                        ${product.modelFormats?.length ? `
                            <span class="product-badge badge-3d">
                                <i class="fas fa-cube"></i> 3B Model
                            </span>
                        ` : ''}
                        ${this.isNewProduct(product) ? `
                            <span class="product-badge badge-new">
                                <i class="fas fa-star"></i> Yeni
                            </span>
                        ` : ''}
                    </div>
                </div>
                <div class="product-content">
                    <div class="product-category">${product.category}</div>
                    <h3 class="product-title">${product.title}</h3>
                    <div class="product-manufacturer">
                        <i class="fas fa-industry"></i>
                        <span>${product.manufacturer?.companyName || 'Bilinmeyen Üretici'}</span>
                    </div>
                    <div class="product-rating">
                        ${this.generateRatingStars(product.rating)}
                        <span class="rating-count">(${product.ratingCount || 0})</span>
                    </div>
                    <div class="product-footer">
                        <div class="product-price">${this.formatPrice(product.price)}</div>
                        <div class="product-actions">
                            <button class="btn btn-secondary" onclick="productManager.showProductDetail('${product._id}')">
                                <i class="fas fa-eye"></i>
                                İncele
                            </button>
                            <button class="btn btn-primary" onclick="cartManager.addToCart('${product._id}')">
                                <i class="fas fa-shopping-cart"></i>
                                Sepete Ekle
                            </button>
                        </div>
                    </div>
                </div>
            `;
            return card;
        },

        isNewProduct(product) {
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            return new Date(product.createdAt) > oneWeekAgo;
        },

        generateRatingStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - Math.ceil(rating);
            
            return `
                <div class="stars">
                    ${Array(fullStars).fill('<i class="fas fa-star"></i>').join('')}
                    ${hasHalfStar ? '<i class="fas fa-star-half-alt"></i>' : ''}
                    ${Array(emptyStars).fill('<i class="far fa-star"></i>').join('')}
                </div>
            `;
        },
            

        formatPrice(price) {
            return new Intl.NumberFormat('tr-TR', {
                style: 'currency',
                currency: 'TRY'
            }).format(price);
        },

        updateProductCount() {
            const count = state.filteredProducts.length;
            document.getElementById('productsCount').textContent = 
                `${count} ürün bulundu`;
        },

        saveFiltersToStorage() {
            localStorage.setItem(FILTERS_KEY, JSON.stringify(state.filters));
        },

        loadFiltersFromStorage() {
            const savedFilters = localStorage.getItem(FILTERS_KEY);
            if (savedFilters) {
                state.filters = { ...state.filters, ...JSON.parse(savedFilters) };
                this.updateFilterUI();
            }
        },

        updateFilterUI() {
            // Kategori filtrelerini güncelle
            const categoryInputs = document.querySelectorAll('.category-item input');
            categoryInputs.forEach(input => {
                input.checked = state.filters.categories.includes(input.value);
            });

            // Fiyat aralığı filtrelerini güncelle
            const { min, max } = state.filters.priceRange;
            if (min !== null) document.getElementById('minPriceInput').value = min;
            if (max !== null) document.getElementById('maxPriceInput').value = max;

            // Sıralama seçeneğini güncelle
            document.getElementById('sortSelect').value = state.filters.sort;

            this.updateActiveFilters();
        },

        updateActiveFilters() {
            const container = document.getElementById('activeFilters');
            container.innerHTML = '';

            // Kategori filtreleri
            state.filters.categories.forEach(category => {
                this.addActiveFilterTag(category, 'category');
            });

            // Fiyat aralığı filtresi
            const { min, max } = state.filters.priceRange;
            if (min !== null || max !== null) {
                const priceText = `${min || 0}₺ - ${max || '∞'}₺`;
                this.addActiveFilterTag(priceText, 'price');
            }

            // Rating filtresi
            if (state.filters.rating) {
                this.addActiveFilterTag(`${state.filters.rating}+ Yıldız`, 'rating');
            }
        },

        addActiveFilterTag(text, type) {
            const container = document.getElementById('activeFilters');
            const tag = document.createElement('div');
            tag.className = 'filter-tag';
            tag.innerHTML = `
                <span>${text}</span>
                <i class="fas fa-times filter-tag-remove" onclick="productManager.removeFilter('${type}', '${text}')"></i>
            `;
            container.appendChild(tag);
        },

        removeFilter(type, value) {
            switch (type) {
                case 'category':
                    state.filters.categories = state.filters.categories.filter(c => c !== value);
                    break;
                case 'price':
                    state.filters.priceRange = { min: null, max: null };
                    break;
                case 'rating':
                    state.filters.rating = null;
                    break;
            }

            this.updateFilterUI();
            this.loadProducts(true);
        },

        clearFilters() {
            state.filters = {
                categories: [],
                priceRange: { min: null, max: null },
                rating: null,
                sort: 'newest',
                search: ''
            };

            this.updateFilterUI();
            this.loadProducts(true);
            localStorage.removeItem(FILTERS_KEY);
        }
    };

    // Sepet Yönetimi
    const cartManager = {
        async addToCart(productId, quantity = 1) {
            try {
                if (!auth.isAuthenticated()) {
                    window.location.href = '/login.html';
                    return;
                }

                showLoading(true);
                const response = await fetchAPI('/cart/add', {
                    method: 'POST',
                    body: JSON.stringify({ productId, quantity })
                });

                if (response.success) {
                    this.updateCartCount(response.cart.itemCount);
                    showNotification('Ürün sepete eklendi', 'success');
                }
            } catch (error) {
                console.error('Sepete ekleme hatası:', error);
                showNotification('Ürün sepete eklenirken bir hata oluştu', 'error');
            } finally {
                showLoading(false);
            }
        },

        updateCartCount(count) {
            document.getElementById('cartCount').textContent = count;
        }
    };

    // Yardımcı Fonksiyonlar
    function showLoading(show) {
        document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
    }

    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = `notification ${type} slide-up`;
        notification.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
            <span>${message}</span>
        `;
        
        document.body.appendChild(notification);
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', () => {
        // Sayfa yüklendiğinde yapılacak işlemler
        initializeApp();
        setupEventListeners();
    });

    async function initializeApp() {
        try {
            showLoading(true);
            auth.updateUI();
            productManager.loadFiltersFromStorage();
            await productManager.loadProducts();
            initializePriceRangeSlider();
        } catch (error) {
            console.error('Uygulama başlatılırken hata:', error);
        } finally {
            showLoading(false);
        }
    }

    function setupEventListeners() {
        // Arama işlemi
        const searchInput = document.getElementById('searchInput');
        let searchTimeout;
        searchInput?.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                state.filters.search = e.target.value.trim();
                productManager.loadProducts(true);
            }, 500);
        });

        // Sıralama işlemi
        document.getElementById('sortSelect')?.addEventListener('change', (e) => {
            state.filters.sort = e.target.value;
            productManager.loadProducts(true);
        });

        // Filtreleri temizleme
        document.getElementById('clearFiltersBtn')?.addEventListener('click', () => {
            productManager.clearFilters();
        });
        const userMenuBtn = document.getElementById('userMenuBtn');
        const userDropdown = document.getElementById('userDropdown');
        
        userMenuBtn?.addEventListener('click', (e) => {
            e.stopPropagation();
            userDropdown.classList.toggle('active');
        });
        
        // Dropdown dışına tıklandığında kapanması için
        document.addEventListener('click', (e) => {
            if (!userMenuBtn?.contains(e.target)) {
                userDropdown?.classList.remove('active');
            }
        });
        // Sonsuz scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && state.pagination.hasMore && !state.loading) {
                    productManager.loadProducts();
                }
            });
        }, {
            root: null,
            rootMargin: '100px',
            threshold: 0.1
        });

        const loadingMore = document.getElementById('loadingMore');
        if (loadingMore) {
            observer.observe(loadingMore);
        }

        // Mobil menü
        const hamburgerBtn = document.getElementById('mobileMenuBtn');
        const navMenu = document.querySelector('.nav-menu');

        hamburgerBtn?.addEventListener('click', () => {
            hamburgerBtn.classList.toggle('active');
            navMenu.classList.toggle('active');
        });

        // Sayfa dışına tıklama ile menüyü kapatma
        document.addEventListener('click', (e) => {
            if (!hamburgerBtn?.contains(e.target) && !navMenu?.contains(e.target)) {
                hamburgerBtn?.classList.remove('active');
                navMenu?.classList.remove('active');
            }
        });
    }
    // setupEventListeners fonksiyonuna ekleyin

    function initializePriceRangeSlider() {
        const slider = document.getElementById('priceRangeSlider');
        if (!slider) return;

        noUiSlider.create(slider, {
            start: [0, 5000],
            connect: true,
            range: {
                'min': 0,
                'max': 5000
            },
            format: {
                to: value => Math.round(value),
                from: value => parseInt(value)
            }
        });

        const minInput = document.getElementById('minPriceInput');
        const maxInput = document.getElementById('maxPriceInput');

        slider.noUiSlider.on('update', (values, handle) => {
            const [min, max] = values;
            minInput.value = min;
            maxInput.value = max;
            
            state.filters.priceRange.min = parseInt(min);
            state.filters.priceRange.max = parseInt(max);
            
            productManager.loadProducts(true);
        });

        // Input değişikliklerini slider'a yansıt
        [minInput, maxInput].forEach((input, index) => {
            input.addEventListener('change', () => {
                const values = [minInput.value, maxInput.value];
                slider.noUiSlider.set(values);
            });
        });
    }
</script>
</body>
</html>
