<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="IndustryHub Pro - Endüstriyel Ürün Kataloğu">
    <title>IndustryHub Pro - Ürün Kataloğu</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Temel Stiller */
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --background-color: #f8fafc;
            --text-color: #1e293b;
            --gray-light: #e2e8f0;
            --gray-dark: #64748b;
            --white: #ffffff;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --transition-base: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.5;
            overflow-x: hidden;
        }
        
        /* Loading Spinner */
        .loader-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            transition: opacity 0.3s ease;
        }
        
        .loader {
            width: 48px;
            height: 48px;
            border: 4px solid var(--gray-light);
            border-bottom-color: var(--primary-color);
            border-radius: 50%;
            animation: rotation 1s linear infinite;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            will-change: transform;
        }
        
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Header Styles */
        .header {
            background: var(--white);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            width: 100%;
            z-index: 1000;
        }
        
        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        /* Logo */
        .logo {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }
        
        /* Search Container */
        .search-container {
            flex: 1;
            max-width: 600px;
            position: relative;
            z-index: 1001;
        }
        
        .search-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .search-bar {
            width: 100%;
            padding: 0.75rem 3rem;
            border: 2px solid var(--gray-light);
            border-radius: 2rem;
            font-size: 0.95rem;
            transition: var(--transition-base);
            background: var(--white);
        }
        
        .search-bar:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 1rem;
            color: var(--gray-dark);
        }
        
        .search-filter-btn {
            position: absolute;
            right: 1rem;
            background: none;
            border: none;
            color: var(--gray-dark);
            cursor: pointer;
            padding: 0.5rem;
        }
        
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--white);
            border-radius: 1rem;
            margin-top: 0.5rem;
            box-shadow: var(--shadow-lg);
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1002;
        }
        
        .advanced-search-panel {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--white);
            border-radius: 1rem;
            margin-top: 0.5rem;
            padding: 1rem;
            box-shadow: var(--shadow-lg);
            display: none;
            z-index: 1002;
        }
        
        /* Navigation Menu */
        .nav-menu {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .nav-link {
            color: var(--text-color);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: var(--transition-base);
        }
        
        .nav-link.active {
            background: var(--primary-color);
            color: var(--white);
        }
        
        .cart-icon {
            position: relative;
        }
        
        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--primary-color);
            color: var(--white);
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 1rem;
        }
        
        /* Filter Section */
        .filter-section {
            background: var(--white);
            border-radius: 1rem;
            padding: 1.5rem;
            margin: 1rem 0 2rem;
            box-shadow: var(--shadow-md);
        }
        
        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .filter-label {
            font-weight: 500;
            color: var(--text-color);
        }
        
        .filter-select {
            padding: 0.75rem;
            border: 1px solid var(--gray-light);
            border-radius: 0.5rem;
            outline: none;
            transition: var(--transition-base);
        }
        
        .filter-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .price-range-inputs {
            display: grid;
            grid-template-columns: 1fr auto 1fr auto;
            align-items: center;
            gap: 0.5rem;
        }
        
        .price-range-inputs input {
            padding: 0.75rem;
            border: 1px solid var(--gray-light);
            border-radius: 0.5rem;
            width: 100%;
        }
        
        .apply-price {
            padding: 0.75rem 1.5rem;
            background: var(--primary-color);
            color: var(--white);
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: var(--transition-base);
        }
        
        .apply-price:hover {
            background: var(--secondary-color);
        }
        
        /* Product Grid */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            padding: 2rem 0;
        }
        
        .product-card {
            background: var(--white);
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: var(--transition-base);
            display: flex;
            flex-direction: column;
            height: 100%;
            will-change: transform;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .product-image-container {
            position: relative;
            padding-top: 75%;
        }
        
        .product-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .product-content {
            padding: 1.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .product-category {
            color: var(--gray-dark);
            font-size: 0.9rem;
        }
        
        .product-title {
            margin: 0.5rem 0;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .product-specs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 0.5rem 0;
        }
        
        .spec-tag {
            background: var(--gray-light);
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
        }
        
        .product-footer {
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .product-price {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .product-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition-base);
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: var(--white);
        }
        
        .btn-secondary {
            background: var(--gray-light);
            color: var(--text-color);
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary-color);
            color: var(--white);
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 2000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header-container {
                padding: 0.5rem;
            }
        
            .logo {
                font-size: 1.1rem;
            }
        
            .nav-menu {
                order: 3;
                width: 100%;
                justify-content: space-around;
                padding: 0.5rem;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        
            .filter-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        
            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .product-grid {
                grid-template-columns: 1fr;
            }
        
            .product-actions {
                flex-direction: column;
            }
        
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
        }
        
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div class="loader-container">
        <div class="loader"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <a href="#" class="logo">
                <i class="fas fa-industry"></i>
                IndustryHub Pro
            </a>
            
            <!-- Gelişmiş Arama Çubuğu -->
            <div class="search-container">
                <div class="search-wrapper">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-bar" placeholder="Ürün veya kategori ara...">
                    <button class="search-filter-btn" id="searchFilterToggle">
                        <i class="fas fa-sliders-h"></i>
                    </button>
                </div>
                <div class="search-suggestions" id="searchSuggestions">
                    <!-- Dinamik olarak doldurulacak -->
                </div>
                <div class="advanced-search-panel" id="advancedSearchPanel">
                    <div class="search-filters">
                        <div class="filter-group">
                            <label>Arama Yeri</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="searchIn" value="title" checked> Ürün Adı</label>
                                <label><input type="checkbox" name="searchIn" value="category" checked> Kategori</label>
                                <label><input type="checkbox" name="searchIn" value="description"> Açıklama</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <nav class="nav-menu">
                <a href="#" class="nav-link active">Ürünler</a>
                <a href="#" class="nav-link">3B Modeller</a>
                <a href="#" class="nav-link">Teknik Çizimler</a>
                <a href="#" class="nav-link cart-icon">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </a>
                <a href="#" class="nav-link">
                    <i class="fas fa-user"></i>
                </a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Filtre Bölümü -->
        <section class="filter-section">
            <div class="filter-header">
                <h3>Filtreler</h3>
                <button class="clear-filters" id="clearFilters">
                    <i class="fas fa-times"></i> Filtreleri Temizle
                </button>
            </div>

            <div class="active-filters" id="activeFilters">
                <!-- Aktif filtreler buraya gelecek -->
            </div>

            <div class="filter-grid">
                <!-- Ana Kategori -->
                <div class="filter-group">
                    <label class="filter-label">Ana Kategori</label>
                    <select class="filter-select" id="mainCategory">
                        <option value="">Tüm Kategoriler</option>
                        <option>Endüstriyel Ekipmanlar</option>
                        <option>Makine Parçaları</option>
                        <option>Otomasyon Sistemleri</option>
                    </select>
                </div>

                <!-- Alt Kategori -->
                <div class="filter-group">
                    <label class="filter-label">Alt Kategori</label>
                    <select class="filter-select" id="subCategory" disabled>
                        <option value="">Seçiniz</option>
                    </select>
                </div>

                <!-- Fiyat Aralığı -->
                <div class="filter-group">
                    <label class="filter-label">Fiyat Aralığı</label>
                    <div class="price-range-inputs">
                        <input type="number" id="minPrice" placeholder="Min">
                        <span>-</span>
                        <input type="number" id="maxPrice" placeholder="Max">
                        <button class="apply-price">Uygula</button>
                    </div>
                </div>

                <!-- Model Format -->
                <div class="filter-group">
                    <label class="filter-label">3B Model Format</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="format" value="STL"> STL</label>
                        <label><input type="checkbox" name="format" value="STEP"> STEP</label>
                        <label><input type="checkbox" name="format" value="OBJ"> OBJ</label>
                    </div>
                </div>

                <!-- Sıralama -->
                <div class="filter-group">
                    <label class="filter-label">Sıralama</label>
                    <select class="filter-select" id="sorting">
                        <option value="recommended">Önerilen</option>
                        <option value="priceAsc">Fiyat (Düşük-Yüksek)</option>
                        <option value="priceDesc">Fiyat (Yüksek-Düşük)</option>
                        <option value="newest">En Yeniler</option>
                        <option value="bestSelling">En Çok Satanlar</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Ürün Grid -->
        <section class="product-grid" id="productGrid">
            <!-- Ürünler dinamik olarak yüklenecek -->
        </section>

        <!-- Loading More Indicator -->
        <div class="loading-more" id="loadingMore" style="display: none;">
            <div class="loader"></div>
            <span>Daha fazla ürün yükleniyor...</span>
        </div>
    </main>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <script>
       // Utility fonksiyonları
        const utils = {
            storage: {
                set(key, value) {
                    try {
                        localStorage.setItem(key, JSON.stringify(value));
                    } catch (e) {
                        console.error('LocalStorage error:', e);
                    }
                },
                get(key) {
                    try {
                        const item = localStorage.getItem(key);
                        return item ? JSON.parse(item) : null;
                    } catch (e) {
                        console.error('LocalStorage error:', e);
                        return null;
                    }
                }
            },
            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },
            createObserver(callback) {
                return new IntersectionObserver(callback, {
                    root: null,
                    rootMargin: '50px',
                    threshold: 0.1
                });
            },
            formatPrice(price) {
                return new Intl.NumberFormat('tr-TR', {
                    style: 'currency',
                    currency: 'TRY'
                }).format(price);
            }
        };
        
        class ProductManager {
            constructor() {
                // Temel özellikler
                this.products = [];
                this.filteredProducts = [];
                this.cart = utils.storage.get('cart') || [];
                this.page = 1;
                this.loading = false;
                this.hasMore = true;
                this.searchTimeout = null;
                this.observer = null;
                this.activeFilters = new Set();
                this.init();
            }
        
            async init() {
                try {
                    await this.setupIntersectionObserver();
                    await this.loadInitialProducts();
                    this.setupEventListeners();
                    this.loadFromLocalStorage();
                    this.updateCartCount();
                    this.setupAdvancedSearch();
                    this.hideLoader();
                } catch (error) {
                    this.handleError(error);
                }
            }
        
            async setupIntersectionObserver() {
                this.observer = utils.createObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting && !this.loading && this.hasMore) {
                            this.loadMoreProducts();
                        }
                    });
                });
            }
        
            async fetchProducts(page, limit = 10) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve({
                            products: Array.from({ length: limit }, (_, i) => ({
                                id: (page - 1) * limit + i + 1,
                                image: `https://via.placeholder.com/400x300?text=Product${(page - 1) * limit + i + 1}`,
                                category: ['Endüstriyel Ekipmanlar', 'Makine Parçaları', 'Otomasyon Sistemleri'][Math.floor(Math.random() * 3)],
                                subCategory: ['Valfler', 'Pompalar', 'Sensörler'][Math.floor(Math.random() * 3)],
                                title: `Endüstriyel Ürün ${(page - 1) * limit + i + 1}`,
                                price: Math.floor(Math.random() * 10000) + 1000,
                                rating: (Math.random() * 2 + 3).toFixed(1),
                                stock: Math.floor(Math.random() * 50) + 1,
                                modelFormats: ['STL', 'STEP', 'OBJ'].slice(0, Math.floor(Math.random() * 3) + 1),
                                specs: ['Teknik Döküman', '3B Model', 'Montaj Kılavuzu'].slice(0, Math.floor(Math.random() * 3) + 1),
                                description: 'Yüksek kaliteli endüstriyel ürün',
                                bestSeller: Math.random() > 0.7
                            })),
                            hasMore: page < 5
                        });
                    }, 1000);
                });
            }
        
            async loadInitialProducts() {
                try {
                    const response = await this.fetchProducts(1);
                    this.products = response.products;
                    this.filteredProducts = [...this.products];
                    this.loadProducts();
                } catch (error) {
                    this.handleError(error);
                }
            }
        
            async loadMoreProducts() {
                if (this.loading || !this.hasMore) return;
        
                this.loading = true;
                document.getElementById('loadingMore').style.display = 'flex';
        
                try {
                    const response = await this.fetchProducts(++this.page);
                    this.products = [...this.products, ...response.products];
                    this.hasMore = response.hasMore;
                    this.filterProducts();
                } catch (error) {
                    this.handleError(error);
                } finally {
                    this.loading = false;
                    document.getElementById('loadingMore').style.display = 'none';
                }
            }
        
            setupEventListeners() {
                // Ana kategori değişikliği
                document.getElementById('mainCategory').addEventListener('change', 
                    (e) => this.handleMainCategoryChange(e.target.value));
        
                // Alt kategori değişikliği
                document.getElementById('subCategory').addEventListener('change',
                    (e) => {
                        if (e.target.value) {
                            this.addActiveFilter('subCategory', e.target.value);
                        } else {
                            this.removeActiveFilter('subCategory');
                        }
                        this.filterProducts();
                    });
        
                // Fiyat filtresi
                document.querySelector('.apply-price').addEventListener('click',
                    () => this.applyPriceFilter());
        
                // Format filtreleri
                document.querySelectorAll('input[name="format"]').forEach(checkbox => {
                    checkbox.addEventListener('change', () => this.handleFormatFilter());
                });
        
                // Sıralama
                document.getElementById('sorting').addEventListener('change',
                    (e) => this.handleSorting(e.target.value));
        
                // Filtreleri temizle
                document.getElementById('clearFilters').addEventListener('click',
                    () => this.clearAllFilters());
        
                // Gelişmiş arama toggle
                document.getElementById('searchFilterToggle').addEventListener('click',
                    () => this.toggleAdvancedSearch());
            }
        
            setupAdvancedSearch() {
                const searchBar = document.querySelector('.search-bar');
                const searchPanel = document.getElementById('advancedSearchPanel');
        
                searchBar.addEventListener('input', utils.debounce((e) => {
                    this.handleSearch(e.target.value);
                }, 300));
        
                document.addEventListener('click', (e) => {
                    if (!searchBar.contains(e.target) && !searchPanel.contains(e.target)) {
                        searchPanel.style.display = 'none';
                    }
                });
            }
        
            handleMainCategoryChange(category) {
                const subCategorySelect = document.getElementById('subCategory');
                subCategorySelect.disabled = !category;
        
                if (category) {
                    this.addActiveFilter('category', category);
                    const subCategories = this.getSubCategories(category);
                    this.populateSubCategories(subCategories);
                } else {
                    this.removeActiveFilter('category');
                    subCategorySelect.innerHTML = '<option value="">Seçiniz</option>';
                }
        
                this.filterProducts();
            }
        
            getSubCategories(mainCategory) {
                const subCategories = {
                    'Endüstriyel Ekipmanlar': ['Valfler', 'Pompalar', 'Filtreler'],
                    'Makine Parçaları': ['Dişliler', 'Rulmanlar', 'Contalar'],
                    'Otomasyon Sistemleri': ['PLC', 'Sensörler', 'Kontrol Üniteleri']
                };
                return subCategories[mainCategory] || [];
            }
        
            populateSubCategories(subCategories) {
                const select = document.getElementById('subCategory');
                select.innerHTML = '<option value="">Seçiniz</option>' +
                    subCategories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
                select.disabled = false;
            }
        
            handleSearch(searchTerm) {
                if (!searchTerm.trim()) {
                    this.filteredProducts = [...this.products];
                    this.loadProducts();
                    return;
                }
        
                const searchIn = Array.from(document.querySelectorAll('input[name="searchIn"]:checked'))
                    .map(input => input.value);
        
                this.filteredProducts = this.products.filter(product => {
                    return searchIn.some(field => {
                        const value = product[field]?.toString().toLowerCase() || '';
                        return value.includes(searchTerm.toLowerCase());
                    });
                });
        
                this.loadProducts();
            }
        
            applyPriceFilter() {
                const minPrice = document.getElementById('minPrice').value;
                const maxPrice = document.getElementById('maxPrice').value;
        
                if (minPrice || maxPrice) {
                    this.addActiveFilter('price', `${minPrice || 0}₺ - ${maxPrice || '∞'}₺`);
                } else {
                    this.removeActiveFilter('price');
                }
        
                this.filterProducts();
            }
        
            handleFormatFilter() {
                const selectedFormats = Array.from(document.querySelectorAll('input[name="format"]:checked'))
                    .map(input => input.value);
        
                if (selectedFormats.length) {
                    this.addActiveFilter('format', selectedFormats.join(', '));
                } else {
                    this.removeActiveFilter('format');
                }
        
                this.filterProducts();
            }
        
            handleSorting(sortValue) {
                switch (sortValue) {
                    case 'priceAsc':
                        this.filteredProducts.sort((a, b) => a.price - b.price);
                        break;
                    case 'priceDesc':
                        this.filteredProducts.sort((a, b) => b.price - a.price);
                        break;
                    case 'newest':
                        this.filteredProducts.sort((a, b) => b.id - a.id);
                        break;
                    case 'bestSelling':
                        this.filteredProducts.sort((a, b) => (b.bestSeller ? 1 : 0) - (a.bestSeller ? 1 : 0));
                        break;
                    default:
                        this.filteredProducts.sort((a, b) => b.rating - a.rating);
                }
                this.loadProducts();
            }
        
            filterProducts() {
                this.filteredProducts = this.products.filter(product => {
                    return Array.from(this.activeFilters).every(filter => {
                        const [type, value] = filter.split(':');
                        switch (type) {
                            case 'category':
                                return product.category === value;
                            case 'subCategory':
                                return product.subCategory === value;
                            case 'format':
                                const formats = value.split(', ');
                                return formats.some(format => product.modelFormats.includes(format));
                            case 'price':
                                const [min, max] = value.replace('₺', '').split(' - ');
                                return product.price >= parseFloat(min) && 
                                       (max === '∞' || product.price <= parseFloat(max));
                            default:
                                return true;
                        }
                    });
                });
        
                this.loadProducts();
            }
        
            loadProducts() {
                const grid = document.getElementById('productGrid');
                grid.innerHTML = '';
        
                if (this.filteredProducts.length === 0) {
                    grid.innerHTML = `
                        <div class="no-results">
                            <i class="fas fa-search fa-3x"></i>
                            <p>Sonuç bulunamadı</p>
                        </div>
                    `;
                    return;
                }
        
                this.filteredProducts.forEach((product, index) => {
                    const card = this.createProductCard(product);
                    card.style.animationDelay = `${index * 50}ms`;
                    grid.appendChild(card);
                });
        
                // Sonsuz scroll için gözlemci ekle
                const observerTarget = document.createElement('div');
                observerTarget.className = 'observer-target';
                grid.appendChild(observerTarget);
                this.observer.observe(observerTarget);
            }
        
            createProductCard(product) {
                const article = document.createElement('article');
                article.className = 'product-card fade-in';
                article.innerHTML = `
                    <div class="product-image-container">
                        <img src="${product.image}" alt="${product.title}" class="product-image" loading="lazy">
                        ${product.modelFormats.length ? `
                            <span class="model-badge">
                                <i class="fas fa-cube"></i>
                                3B Model
                            </span>
                        ` : ''}
                        ${product.bestSeller ? `
                            <span class="bestseller-badge">
                                <i class="fas fa-award"></i>
                                Çok Satan
                            </span>
                        ` : ''}
                    </div>
                    <div class="product-content">
                        <div class="product-category">${product.category}</div>
                        <h3 class="product-title">${product.title}</h3>
                        <div class="product-specs">
                            ${product.specs.map(spec => `
                                <span class="spec-tag">${spec}</span>
                            `).join('')}
                        </div>
                        <div class="product-rating">
                            ${this.generateRatingStars(product.rating)}
                            <span class="stock-info">${product.stock} adet stokta</span>
                        </div>
                        <div class="product-footer">
                            <div class="product-price">${utils.formatPrice(product.price)}</div>
                            <div class="product-actions">
                                <button class="btn btn-secondary" onclick="productManager.viewProduct(${product.id})">
                                    <i class="fas fa-eye"></i>
                                    İncele
                                </button>
                                <button class="btn btn-primary" onclick="productManager.addToCart(${product.id})">
                                    <i class="fas fa-shopping-cart"></i>
                                    Sepete Ekle
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                return article;
            }
        
            generateRatingStars(rating) {
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 !== 0;
                let html = '<div class="stars">';
                
                for (let i = 0; i < fullStars; i++) {
                    html += '<i class="fas fa-star"></i>';
                }
                if (hasHalfStar) {
                    html += '<i class="fas fa-star-half-alt"></i>';
                }
                const emptyStars = 5 - Math.ceil(rating);
                for (let i = 0; i < emptyStars; i++) {
                    html += '<i class="far fa-star"></i>';
                }
                
                html += `<span class="rating-text">(${rating})</span></div>`;
                return html;
            }
        
            addToCart(productId) {
                const product = this.products.find(p => p.id === productId);
                if (!product) return;
        
                const existingItem = this.cart.find(item => item.id === productId);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    this.cart.push({ ...product, quantity: 1 });
                }
        
                utils.storage.set('cart', this.cart);
                this.updateCartCount();
                this.showNotification('Ürün sepete eklendi');
            }
        
            viewProduct(productId) {
                // Ürün detay modalı için yer tutucu
                this.showNotification('Bu özellik yakında eklenecek');
            }
        
            updateCartCount() {
                const cartCount = document.querySelector('.cart-count');
                const totalItems = this.cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCount.textContent = totalItems;
            }
        
            toggleAdvancedSearch() {
                const panel = document.getElementById('advancedSearchPanel');
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            }
        
            addActiveFilter(type, value) {
                this.activeFilters.add(`${type}:${value}`);
                this.updateActiveFiltersUI();
                this.saveFiltersToStorage();
            }
        
            removeActiveFilter(type) {
                Array.from(this.activeFilters)
                    .filter(filter => filter.startsWith(`${type}:`))
                    .forEach(filter => this.activeFilters.delete(filter));
                this.updateActiveFiltersUI();
                this.saveFiltersToStorage();
            }
        
            updateActiveFiltersUI() {
                const container = document.getElementById('activeFilters');
                container.innerHTML = Array.from(this.activeFilters).map(filter => `
                    <span class="filter-tag">
                        ${filter.split(':')[1]}
                        <i class="fas fa-times" onclick="productManager.removeFilter('${filter}')"></i>
                    </span>
                `).join('');
            }
        
            removeFilter(filter) {
                this.activeFilters.delete(filter);
                this.updateActiveFiltersUI();
                this.filterProducts();
                this.saveFiltersToStorage();
            }
        
            saveFiltersToStorage() {
                const filters = {
                    mainCategory: document.getElementById('mainCategory').value,
                    subCategory: document.getElementById('subCategory').value,
                    minPrice: document.getElementById('minPrice').value,
                    maxPrice: document.getElementById('maxPrice').value,
                    formats: Array.from(document.querySelectorAll('input[name="format"]:checked'))
                        .map(cb => cb.value),
                    sorting: document.getElementById('sorting').value
                };
                utils.storage.set('filters', filters);
            }
        
            loadFromLocalStorage() {
                try {
                    const savedFilters = utils.storage.get('filters');
                    if (savedFilters) {
                        if (savedFilters.mainCategory) {
                            document.getElementById('mainCategory').value = savedFilters.mainCategory;
                            this.handleMainCategoryChange(savedFilters.mainCategory);
                        }
                        if (savedFilters.subCategory) {
                            document.getElementById('subCategory').value = savedFilters.subCategory;
                        }
                        if (savedFilters.minPrice) {
                            document.getElementById('minPrice').value = savedFilters.minPrice;
                        }
                        if (savedFilters.maxPrice) {
                            document.getElementById('maxPrice').value = savedFilters.maxPrice;
                        }
                        if (savedFilters.formats) {
                            savedFilters.formats.forEach(format => {
                                const checkbox = document.querySelector(`input[name="format"][value="${format}"]`);
                                if (checkbox) checkbox.checked = true;
                            });
                        }
                        if (savedFilters.sorting) {
                            document.getElementById('sorting').value = savedFilters.sorting;
                        }
                        this.filterProducts();
                    }
        
                    const savedCart = utils.storage.get('cart');
                    if (savedCart) {
                        this.cart = savedCart;
                        this.updateCartCount();
                    }
                } catch (error) {
                    console.error('Error loading from localStorage:', error);
                    this.showNotification('Kayıtlı veriler yüklenirken bir hata oluştu', 'error');
                }
            }
        
            clearAllFilters() {
                this.activeFilters.clear();
                this.updateActiveFiltersUI();
                
                document.getElementById('mainCategory').value = '';
                document.getElementById('subCategory').value = '';
                document.getElementById('subCategory').disabled = true;
                document.getElementById('minPrice').value = '';
                document.getElementById('maxPrice').value = '';
                document.getElementById('sorting').value = 'recommended';
                document.querySelectorAll('input[name="format"]')
                    .forEach(cb => cb.checked = false);
        
                this.filterProducts();
                utils.storage.set('filters', null);
            }
        
            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.className = `notification ${type} fade-in`;
                notification.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    <span>${message}</span>
                `;
                document.getElementById('notificationContainer').appendChild(notification);
                setTimeout(() => {
                    notification.classList.add('fade-out');
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }
        
                handleError(error) {
                    console.error('An error occurred:', error);
                    this.showNotification('Bir hata oluştu. Lütfen daha sonra tekrar deneyin.', 'error');
                }
            
                hideLoader() {
                    const loader = document.querySelector('.loader-container');
                    loader.style.opacity = '0';
                    setTimeout(() => loader.style.display = 'none', 300);
                }
            }
            
            // Sayfa yüklendiğinde ProductManager'ı başlat
            document.addEventListener('DOMContentLoaded', () => {
                window.productManager = new ProductManager();
            });
    </script>
</body>
</html>
